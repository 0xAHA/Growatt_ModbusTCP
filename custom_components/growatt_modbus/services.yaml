read_inverter_data:
  name: Read Inverter Data
  description: Manually trigger a data read from the Growatt inverter
  fields:
    device_id:
      name: Device
      description: The Growatt inverter device
      required: true
      selector:
        device:
          integration: growatt_modbus
    force_refresh:
      name: Force Refresh
      description: Force a fresh read even if within minimum interval
      default: false
      selector:
        boolean:

test_connection:
  name: Test Connection
  description: Test the connection to the Growatt inverter
  fields:
    device_id:
      name: Device
      description: The Growatt inverter device
      required: true
      selector:
        device:
          integration: growatt_modbus

get_register_data:
  name: Get Register Data
  description: Read specific Modbus registers for debugging
  fields:
    device_id:
      name: Device
      description: The Growatt inverter device
      required: true
      selector:
        device:
          integration: growatt_modbus
    register_type:
      name: Register Type
      description: Type of registers to read
      default: "input"
      selector:
        select:
          options:
            - "input"
            - "holding"
    start_address:
      name: Start Address
      description: Starting register address
      default: 3000
      selector:
        number:
          min: 0
          max: 65535
          mode: box
    count:
      name: Register Count
      description: Number of registers to read
      default: 10
      selector:
        number:
          min: 1
          max: 50
          mode: box

update_register_map:
  name: Update Register Map
  description: Change the register mapping for the inverter
  fields:
    device_id:
      name: Device
      description: The Growatt inverter device
      required: true
      selector:
        device:
          integration: growatt_modbus
    register_map:
      name: Register Map
      description: Select the register mapping to use
      default: "MIN_10000_VARIANT_A"
      selector:
        select:
          options:
            - "MIN_SERIES_STANDARD"
            - "MIN_10000_VARIANT_A"

export_register_dump:
  name: Universal Register Scanner
  description: Scan ALL register ranges, auto-detect your inverter model, and export complete register dump to CSV. File saved to /config/growatt_register_scan_[timestamp].csv
  fields:
    host:
      name: IP Address
      description: IP address of your RS485-TCP adapter
      required: true
      example: "192.168.1.60"
      selector:
        text:
    port:
      name: Port
      description: Modbus TCP port (usually 502)
      required: false
      default: 502
      selector:
        number:
          min: 1
          max: 65535
          mode: box
    slave_id:
      name: Slave ID
      description: Modbus slave/unit ID (usually 1)
      required: false
      default: 1
      selector:
        number:
          min: 1
          max: 247
          mode: box
    notify:
      name: Show Notification
      description: Display detection results as a persistent notification
      required: false
      default: true
      selector:
        boolean:

write_register:
  name: Write Modbus Register
  description: Write a value to a specific Modbus holding register for advanced inverter control
  fields:
    device_id:
      name: Device
      description: The Growatt inverter device
      required: true
      selector:
        device:
          integration: growatt_modbus
    register:
      name: Register Address
      description: Holding register address to write to (e.g., 0 for on/off, 3 for power rate, 30 for modbus address)
      required: true
      example: 0
      selector:
        number:
          min: 0
          max: 65535
          mode: box
    value:
      name: Value
      description: Value to write to the register (as integer, already scaled if needed)
      required: true
      example: 1
      selector:
        number:
          min: -32768
          max: 65535
          mode: box

detect_grid_orientation:
  name: Detect Grid CT Orientation
  description: Automatically detect if your grid power CT clamp needs inversion for correct Home Assistant display. Run this when solar is producing and exporting to grid.
  fields:
    device_id:
      name: Device
      description: The Growatt inverter device (optional - uses first found if not specified)
      required: false
      selector:
        device:
          integration: growatt_modbus