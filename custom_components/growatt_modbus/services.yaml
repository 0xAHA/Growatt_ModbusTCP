read_inverter_data:
  name: Read Inverter Data
  description: Manually trigger a data read from the Growatt inverter
  fields:
    device_id:
      name: Device
      description: The Growatt inverter device
      required: true
      selector:
        device:
          integration: growatt_modbus
    force_refresh:
      name: Force Refresh
      description: Force a fresh read even if within minimum interval
      default: false
      selector:
        boolean:

test_connection:
  name: Test Connection
  description: Test the connection to the Growatt inverter
  fields:
    device_id:
      name: Device
      description: The Growatt inverter device
      required: true
      selector:
        device:
          integration: growatt_modbus

get_register_data:
  name: Get Register Data
  description: Read specific Modbus registers for debugging
  fields:
    device_id:
      name: Device
      description: The Growatt inverter device
      required: true
      selector:
        device:
          integration: growatt_modbus
    register_type:
      name: Register Type
      description: Type of registers to read
      default: "input"
      selector:
        select:
          options:
            - "input"
            - "holding"
    start_address:
      name: Start Address
      description: Starting register address
      default: 3000
      selector:
        number:
          min: 0
          max: 65535
          mode: box
    count:
      name: Register Count
      description: Number of registers to read
      default: 10
      selector:
        number:
          min: 1
          max: 50
          mode: box

update_register_map:
  name: Update Register Map
  description: Change the register mapping for the inverter
  fields:
    device_id:
      name: Device
      description: The Growatt inverter device
      required: true
      selector:
        device:
          integration: growatt_modbus
    register_map:
      name: Register Map
      description: Select the register mapping to use
      default: "MIN_10000_VARIANT_A"
      selector:
        select:
          options:
            - "MIN_SERIES_STANDARD"
            - "MIN_10000_VARIANT_A"

export_register_dump:
  name: Universal Register Scanner
  description: Scan ALL register ranges, auto-detect your inverter model, and export complete register dump to CSV. Supports both TCP and USB/Serial connections. Entity values are automatically included if you have a configured device with matching connection parameters. File saved to /config/growatt_register_scan_[timestamp].csv
  target:
  fields:
    connection_type:
      name: Connection Type
      description: Select TCP (RS485-to-Ethernet adapter) or Serial (RS485-to-USB adapter)
      required: false
      default: "tcp"
      selector:
        select:
          options:
            - label: "TCP (Ethernet)"
              value: "tcp"
            - label: "Serial (USB)"
              value: "serial"
    host:
      name: IP Address (TCP only)
      description: IP address of your RS485-TCP adapter (required for TCP connection)
      required: false
      example: "192.168.1.60"
      selector:
        text:
    port:
      name: Port (TCP only)
      description: Modbus TCP port (usually 502, required for TCP connection)
      required: false
      default: 502
      selector:
        number:
          min: 1
          max: 65535
          mode: box
    device:
      name: Serial Device (Serial only)
      description: Serial port path for USB adapter (required for Serial connection)
      required: false
      example: "/dev/ttyUSB0 or COM3"
      selector:
        text:
    baudrate:
      name: Baudrate (Serial only)
      description: Serial communication speed (usually 9600 for Growatt)
      required: false
      default: "9600"
      selector:
        select:
          options:
            - "4800"
            - "9600"
            - "19200"
            - "38400"
            - "57600"
            - "115200"
    slave_id:
      name: Slave ID
      description: Modbus slave/unit ID (usually 1)
      required: false
      default: 1
      selector:
        number:
          min: 1
          max: 247
          mode: box
    notify:
      name: Show Notification
      description: Display detection results as a persistent notification
      required: false
      default: true
      selector:
        boolean:
    offgrid_mode:
      name: OffGrid Mode (SPF Safety)
      description: "**⚠️ CRITICAL FOR SPF INVERTERS:** Enable this if you have an Off-Grid inverter (SPF 3000-6000 ES PLUS). Off-Grid inverters will experience a POWER RESET if this is disabled. Leave disabled for grid-tied inverters (MIN, SPH, MOD, WIT, etc.)"
      required: false
      default: false
      selector:
        boolean:

write_register:
  name: Write Modbus Register
  description: Write a value to a specific Modbus holding register for advanced inverter control
  fields:
    device_id:
      name: Device
      description: The Growatt inverter device
      required: true
      selector:
        device:
          integration: growatt_modbus
    register:
      name: Register Address
      description: Holding register address to write to (e.g., 0 for on/off, 3 for power rate, 30 for modbus address)
      required: true
      example: 0
      selector:
        number:
          min: 0
          max: 65535
          mode: box
    value:
      name: Value
      description: Value to write to the register (as integer, already scaled if needed)
      required: true
      example: 1
      selector:
        number:
          min: -32768
          max: 65535
          mode: box

detect_grid_orientation:
  name: Detect Grid CT Orientation
  description: Automatically detect if your grid power CT clamp needs inversion for correct Home Assistant display. Run this when solar is producing and exporting to grid.
  fields:
    device_id:
      name: Device
      description: The Growatt inverter device (optional - uses first found if not specified)
      required: false
      selector:
        device:
          integration: growatt_modbus

read_register:
  name: Read Register
  description: Read a specific Modbus register with detailed profile-aware output. Shows raw value, scale, paired register calculations, and entity values in a persistent notification.
  fields:
    device_id:
      name: Device
      description: The Growatt inverter device
      required: true
      selector:
        device:
          integration: growatt_modbus
    register:
      name: Register Address
      description: Register address to read (e.g., 3 for PV1 voltage, 31201 for battery power)
      required: true
      example: 3
      selector:
        number:
          min: 0
          max: 65535
          mode: box
    register_type:
      name: Register Type
      description: Type of register to read
      default: "input"
      selector:
        select:
          options:
            - label: "Input Register (Read-Only Sensors)"
              value: "input"
            - label: "Holding Register (Settings/Control)"
              value: "holding"